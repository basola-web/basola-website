---
const { t } = Astro.props;
---

<section id="problem" class="py-16 px-6 bg-[#FAFAF9] dark:bg-[#0B0B0C]">
  <div class="mx-auto max-w-6xl">
    <header class="mb-12 text-center">
      <h2 class="text-3xl md:text-4xl font-extrabold text-basola-brown reveal">{t.heading}</h2>
      <p class="mt-4 text-basola-brown/80 max-w-3xl mx-auto reveal">{t.intro}</p>
    </header>

    <div class="md:grid md:grid-cols-3 md:gap-8">
      <div class="md:col-span-2 space-y-6">
        <article class="reveal rounded-2xl border border-neutral-200 dark:border-neutral-700 bg-white dark:bg-neutral-900 shadow-sm p-6 transition-transform hover:-translate-y-0.5">
          <h3 class="flex items-center gap-2 text-xl font-semibold text-basola-brown">
            <span class="text-2xl">{t.cards.burning.icon}</span>
            {t.cards.burning.title}
          </h3>
          <p class="mt-2 text-basola-brown/80">
            {t.cards.burning.text}
            <sup><a href="#fn1" class="underline">[1]</a><a href="#fn2" class="underline">[2]</a></sup>
          </p>
        </article>

        <article class="reveal rounded-2xl border border-neutral-200 dark:border-neutral-700 bg-white dark:bg-neutral-900 shadow-sm p-6 transition-transform hover:-translate-y-0.5">
          <h3 class="flex items-center gap-2 text-xl font-semibold text-basola-brown">
            <span class="text-2xl">{t.cards.dumps.icon}</span><span class="text-2xl">{t.cards.dumps.icon2}</span>
            {t.cards.dumps.title}
          </h3>
          <p class="mt-2 text-basola-brown/80">
            {t.cards.dumps.text}
            <sup><a href="#fn3" class="underline">[3]</a><a href="#fn4" class="underline">[4]</a></sup>
          </p>
        </article>
      </div>

      <div class="mt-6 md:mt-0">
        <article class="reveal rounded-2xl border border-neutral-200 dark:border-neutral-700 bg-white dark:bg-neutral-900 shadow-sm p-6 transition-transform hover:-translate-y-0.5">
          <div class="flex items-center gap-2">
            <span class="text-2xl">{t.cards.fuel.icon}</span>
            <h3 class="text-xl font-semibold text-basola-brown">{t.cards.fuel.title}</h3>
            <span class="ml-auto text-xs text-basola-brown bg-amber-100 dark:bg-amber-900/40 border border-amber-200 dark:border-amber-700 px-2 py-0.5 rounded-full">{t.cards.fuel.badge}</span>
          </div>
          <p class="mt-2 text-basola-brown/80">
            {t.cards.fuel.text}
            <sup><a href="#fn5" class="underline">[5]</a><a href="#fn6" class="underline">[6]</a></sup>
          </p>
        </article>
      </div>
    </div>

    <div class="mt-12 text-center reveal">
      <p class="inline-block text-lg font-medium text-basola-brown relative">
        {t.transition}
        <span class="underline absolute left-0 -bottom-1 h-0.5 w-full bg-basola-yellow origin-left scale-x-0"></span>
      </p>
    </div>
    <footer class="mt-12 text-basola-brown/70 text-sm reveal">
      <button id="sourcesToggle" class="underline text-basola-brown" type="button">{t.sources.label}</button>
      <dialog id="sourcesDialog" class="rounded-lg p-6 w-full max-w-md bg-white dark:bg-neutral-900 text-basola-brown">
        <h3 class="text-lg font-semibold mb-4">{t.sources.label}</h3>
        <ol class="list-decimal pl-4 space-y-1">
          {t.sources.items.map((fn, idx) => (
            <li id={`fn${idx + 1}`}><a href={fn.url} target="_blank" rel="noopener noreferrer" class="underline">{fn.label}</a></li>
          ))}
        </ol>
        <button id="closeSources" class="mt-4 underline">{t.sources.close}</button>
      </dialog>
    </footer>
  </div>

  <script is:client>
    const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    const reveals = document.querySelectorAll('.reveal');
    const io = new IntersectionObserver(entries => {
      entries.forEach(e => {
        if (e.isIntersecting) {
          e.target.classList.add('visible');
          io.unobserve(e.target);
        }
      });
    }, { threshold: 0.2 });

    if (!prefersReduced) {
      reveals.forEach(el => io.observe(el));
    } else {
      reveals.forEach(el => el.classList.add('visible'));
    }

    const toggle = document.getElementById('sourcesToggle');
    const dialog = document.getElementById('sourcesDialog');
    const closeBtn = document.getElementById('closeSources');
    toggle?.addEventListener('click', () => dialog?.showModal());
    closeBtn?.addEventListener('click', () => dialog?.close());

    const footnotes = document.querySelectorAll('a[href^="#fn"]');
    footnotes.forEach(link => {
      link.addEventListener('click', e => {
        e.preventDefault();
        const target = link.getAttribute('href')?.substring(1);
        dialog?.showModal();
        if (target) {
          document.getElementById(target)?.scrollIntoView();
        }
      });
    });
  </script>

  <style>
    .reveal { opacity: 0; transform: translateY(12px); }
    .reveal.visible { opacity: 1; transform: translateY(0); transition: opacity 700ms, transform 700ms; }
    .reveal.visible .underline { transform: scaleX(1); transition: transform 700ms; }
  </style>
</section>

