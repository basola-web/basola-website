---
interface KPI { id: string; value: number; suffix: string; label: string; }
interface Split { fuelPct: number; syngasPct: number; restPct: number; }

const {
  lang = 'de',
  title = lang === 'de' ? 'Impact in Ladrilleros' : 'Impact in Ladrilleros',
  subtitle = lang === 'de'
    ? 'Plastik wird lokale Energie – für Umwelt, Menschen & Zukunft.'
    : 'Turning plastic into local energy — for people, planet & the future.',
  kpis = (lang === 'de'
    ? [
        { id:'k1', value:80, suffix:' kg/Tag', label:'Sauber verarbeitet statt verbrannt/angeschwemmt' },
        { id:'k2', value:50, suffix:'+ t CO₂/Jahr', label:'Vermieden (≈2,3 kg CO₂ pro kg Plastik)' },
        { id:'k3', value:2,  suffix:' Jobs', label:'Vollzeit, ≥2× kolumb. Mindestlohn' },
        { id:'k4', value:100, suffix:'%', label:'Saubere Luft – keine offene Verbrennung' },
        { id:'k5', value:1, suffix:' Community', label:'Strandreinigung wird vergütete Ressource' },
        { id:'k6', value:1, suffix:' Solar', label:'Überschuss stärkt Resilienz der Stromversorgung' },
      ]
    : [
        { id:'k1', value:80, suffix:' kg/day', label:'Cleanly processed (no burning/dumping)' },
        { id:'k2', value:50, suffix:'+ t CO₂/year', label:'Avoided (≈2.3 kg CO₂ per kg plastic)' },
        { id:'k3', value:2,  suffix:' jobs', label:'Full-time, ≥2× min wage' },
        { id:'k4', value:100, suffix:'%', label:'Cleaner air — no open burning' },
        { id:'k5', value:1, suffix:' community', label:'Beach plastics become paid resource' },
        { id:'k6', value:1, suffix:' solar', label:'Surplus boosts grid resilience' },
      ]) as KPI[],
  split = { fuelPct:50, syngasPct:40, restPct:10 } as Split,
  sectionId = 'impact',
} = Astro.props;
---

<section id={sectionId} class="relative py-16 bg-[#FFB703]/20">
  <div class="mx-auto max-w-6xl px-6">
    <header class="mb-8 text-center">
      <h2 class="text-3xl md:text-4xl font-extrabold text-basola-brown">{title}</h2>
      <p class="mt-2 text-basola-brown/80">{subtitle}</p>
    </header>

    <!-- KPI Grid -->
    <div class="grid gap-5 sm:grid-cols-2 lg:grid-cols-3">
      {kpis.map(k => (
        <div class="rounded-2xl bg-white ring-1 ring-black/5 shadow-sm p-6">
          <div class="text-4xl font-extrabold text-basola-yellow">
            <span id={k.id}>0</span>{k.suffix}
          </div>
          <div class="mt-1 text-sm text-basola-brown/80">{k.label}</div>
        </div>
      ))}
    </div>

    <!-- Output Split -->
    <div class="mt-10 rounded-2xl bg-white ring-1 ring-black/5 shadow-sm p-6">
      <div class="mb-3 flex items-center justify-between">
        <span class="font-semibold text-basola-brown">{lang==='de'?'Output-Verteilung':'Output split'}</span>
        <span class="text-sm text-basola-brown/70">
          Fuel {split.fuelPct}% · Syngas {split.syngasPct}% · Rest {split.restPct}%
        </span>
      </div>
      <div class="h-4 w-full overflow-hidden rounded-full bg-basola-brown/10">
        <div class="h-full bg-basola-yellow" style={`width:${split.fuelPct}%`}></div>
        <div class="h-full bg-[#F8D26A]" style={`width:${split.syngasPct}%`}></div>
        <div class="h-full bg-basola-brown/40" style={`width:${split.restPct}%`}></div>
      </div>
      <p class="mt-3 text-xs text-basola-brown/70">
        {lang==='de'
          ? 'Kein Sauerstoff, keine offene Verbrennung. Syngas heizt den Prozess.'
          : 'No oxygen, no open burning. Syngas powers the process.'}
      </p>
    </div>
  </div>

  <!-- CountUp + Reveal -->
  <script is:client>
    const ease=(t)=>(--t)*t*t+1;
    const animate=(el,to,dur=1200)=>{const s=performance.now();const step=n=>{const p=Math.min(1,(n-s)/dur);el.textContent=Math.round(ease(p)*to).toLocaleString('de-DE');if(p<1)requestAnimationFrame(step)};requestAnimationFrame(step)};
    const once=(root)=>{const ids=[...document.querySelectorAll('#impact [id^="k"]')];
      const io=new IntersectionObserver(es=>{
        if(es[0].isIntersecting){ids.forEach((el,i)=>animate(el,Number(el.id==='k2'?el.textContent:el.getAttribute('data-to')||el.textContent),900+80*i));io.disconnect()}
      },{threshold:.35});
      io.observe(document.getElementById('impact'));
    };
    // set data-to for kpis
    document.querySelectorAll('#impact [id^="k"]').forEach(el=>{
      const t=el.textContent; el.setAttribute('data-to', t); el.textContent='0';
    });
    once(document.getElementById('impact'));
  </script>
</section>
