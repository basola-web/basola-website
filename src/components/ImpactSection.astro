---
interface Tile {
  value?: number;
  label?: string;
  suffix?: string;
  title: string;
  description: string;
  color: string;
}

const {
  lang = 'de',
  heading = lang === 'de' ? 'Impact in Ladrilleros' : 'Impact in Ladrilleros',
  subheading =
    lang === 'de'
      ? 'Plastik wird lokale Energie – für Umwelt, Menschen & Zukunft.'
      : 'Plastic becomes local energy — for people, planet & future.',
  tiles = (lang === 'de'
    ? [
        {
          value: 80,
          suffix: ' kg',
          title: 'Plastikabfälle pro Tag',
          description: 'Reduziert im Dorf gesammelt & verarbeitet.',
          color: '#c97b00'
        },
        {
          value: 86,
          suffix: ' kg',
          title: 'weniger CO₂ pro Tag',
          description: 'Keine Verbrennung – kein CO₂-Ausstoß.',
          color: '#2a7736'
        },
        {
          value: 2,
          suffix: ' Jobs',
          title: 'Vollzeitstellen',
          description: 'Geschaffen mit doppeltem kolumb. Mindestlohn.',
          color: '#8b001a'
        },
        {
          value: 1123,
          suffix: ' USD',
          title: 'Umsatz pro Monat',
          description: 'Bruttoumsatz aus lokalem Kraftstoffverkauf.',
          color: '#8b001a'
        },
        {
          label: 'Community',
          title: 'vergütete Strandreinigung',
          description: 'Plastik wird zur Wertressource.',
          color: '#c97b00'
        },
        {
          value: 100,
          suffix: '% Solar',
          title: 'Energieautarkie',
          description: 'Betrieb durch Sonnenenergie.',
          color: '#f9c700'
        }
      ]
    : [
        {
          value: 80,
          suffix: ' kg',
          title: 'Plastic waste per day',
          description: 'Collected & processed in the village.',
          color: '#c97b00'
        },
        {
          value: 86,
          suffix: ' kg',
          title: 'less CO₂ per day',
          description: 'No burning — no CO₂ emissions.',
          color: '#2a7736'
        },
        {
          value: 2,
          suffix: ' jobs',
          title: 'full-time jobs',
          description: 'Created with double Colombian minimum wage.',
          color: '#8b001a'
        },
        {
          value: 1123,
          suffix: ' USD',
          title: 'revenue per month',
          description: 'Gross revenue from local fuel sales.',
          color: '#8b001a'
        },
        {
          label: 'Community',
          title: 'paid beach cleanup',
          description: 'Plastic becomes a valuable resource.',
          color: '#c97b00'
        },
        {
          value: 100,
          suffix: '% solar',
          title: 'energy autonomy',
          description: 'Powered by solar energy.',
          color: '#f9c700'
        }
      ]) as Tile[],
  sectionId = 'impact'
} = Astro.props;
---

<section id={sectionId} class="relative py-16 bg-[#FFF4D5]">
  <div class="mx-auto max-w-6xl px-6">
    <header class="mb-12 text-center">
      <h2 class="text-3xl md:text-4xl font-extrabold text-basola-brown">{heading}</h2>
      <p class="mt-2 text-basola-brown/80">{subheading}</p>
    </header>

    <div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
      {tiles.map((t) => (
        <div
          class="kpi-tile rounded-2xl bg-white ring-1 ring-black/5 shadow-sm p-6 text-center opacity-0 translate-y-6 transition duration-700"
        >
          <div class="mx-auto mb-2 h-8 w-8"></div>
          {t.value !== undefined ? (
            <div class="text-4xl font-extrabold" style={`color:${t.color}`}>
              <span class="counter" data-to={t.value}>0</span>{t.suffix}
            </div>
          ) : (
            <div class="text-4xl font-extrabold" style={`color:${t.color}`}>{t.label}</div>
          )}
          <h3 class="mt-2 font-semibold text-basola-brown">{t.title}</h3>
          <p class="mt-1 text-sm text-basola-brown/80">{t.description}</p>
        </div>
      ))}
    </div>
  </div>

  <script is:client>
    const locale = "${lang === 'de' ? 'de-DE' : 'en-US'}";
    const ease = (t) => (--t) * t * t + 1;
    const animate = (el, to, dur = 1200) => {
      const s = performance.now();
      const step = (n) => {
        const p = Math.min(1, (n - s) / dur);
        el.textContent = Math.round(ease(p) * to).toLocaleString(locale);
        if (p < 1) requestAnimationFrame(step);
      };
      requestAnimationFrame(step);
    };
    document
      .querySelectorAll('#${sectionId} [data-to]')
      .forEach((el) => (el.textContent = '0'));
    const tiles = document.querySelectorAll('#${sectionId} .kpi-tile');
    const io = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            const tile = entry.target;
            tile.classList.remove('opacity-0', 'translate-y-6');
            tile.classList.add('opacity-100', 'translate-y-0');
            const c = tile.querySelector('[data-to]');
            if (c) animate(c, Number(c.getAttribute('data-to')));
            io.unobserve(tile);
          }
        });
      },
      { threshold: 0.35 }
    );
    tiles.forEach((tile) => io.observe(tile));
  </script>
</section>
