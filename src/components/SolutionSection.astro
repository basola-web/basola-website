---
import {
  Trash2,
  Scissors,
  Thermometer,
  Wind,
  Droplets,
  Fuel,
  Flame,
  FlaskConical,
  Filter,
} from 'lucide-astro';

interface Step {
  title: string;
  text: string;
  icon: any;
}

interface Card {
  title: string;
  text: string;
  icon: any;
}

const steps: Step[] = [
  {
    title: 'Plastikabfall',
    text: 'Gemischte Kunststoffe als Rohstoff.',
    icon: Trash2,
  },
  {
    title: 'Shredder',
    text: 'Zerkleinert zu handlichen Flakes.',
    icon: Scissors,
  },
  {
    title: 'Pyrolyse (400–550 °C, O₂-frei)',
    text: 'Thermische Zersetzung ohne offene Flamme.',
    icon: Thermometer,
  },
  {
    title: 'Syn-Gas: kontrollierte Verbrennung',
    text: 'Gas verbrennt sauber und liefert Energie.',
    icon: Wind,
  },
  {
    title: 'Kondensation',
    text: 'Abkühlung trennt flüchtige Fraktionen.',
    icon: Droplets,
  },
  {
    title: 'Fuel (Benzin, Diesel)',
    text: 'Flüssiger Treibstoff als Ergebnis.',
    icon: Fuel,
  },
];

const cards: Card[] = [
  {
    title: 'Energieeffizienz',
    text: 'Primär erwärmt durch Solarenergie. Syn-Gas steigert Effizienz zusätzlich.',
    icon: Flame,
  },
  {
    title: 'Katalytische Optimierung',
    text: 'Spezielle Katalysatoren erhöhen die Ausbeute und senken gezielt Schadstoffe durch Systemparameter.',
    icon: FlaskConical,
  },
  {
    title: 'Abgasreinigung',
    text: 'Abgase werden gefiltert. Übriges Syn-Gas wird verbrannt und heizt das System.',
    icon: Filter,
  },
];
---

<section id="loesung" class="font-sans tracking-tight">
  <div class="py-16 mx-auto max-w-6xl px-6">
    <header class="mb-10 text-center md:text-left">
      <h2 class="text-3xl md:text-4xl font-extrabold text-[#723100]">♻️ Unsere Lösung: Sauberer Treibstoff aus Plastikmüll</h2>
      <p class="mt-4 text-lg text-[#723100]/90 max-w-3xl mx-auto md:mx-0">
        Wir verwandeln gemischten Plastikabfall in synthetischen Treibstoff in einem geschlossenen System.
        Der Prozess arbeitet ohne offene Verbrennung und liefert sofort nutzbare Energie.
      </p>
    </header>

    <!-- Stepper -->
    <div id="stepper" class="mb-16">
      <!-- mobile vertical -->
      <div class="md:hidden flex flex-col gap-6">
        {steps.map((s) => (
          <div class="flex gap-4">
            <div class="shrink-0">
              <s.icon class="w-8 h-8 text-[#FFB703]" />
            </div>
            <div>
              <h3 class="font-semibold text-[#723100]">{s.title}</h3>
              <p class="text-sm text-[#723100]/80">{s.text}</p>
            </div>
          </div>
        ))}
      </div>

      <!-- desktop horizontal -->
      <div class="hidden md:block">
        <div class="relative">
          <div class="h-1 bg-[#723100]/30 w-full"></div>
          <div id="progress" class="absolute h-1 bg-[#FFB703] w-0 top-0 left-0 transition-[width] duration-1000"></div>

          <div class="absolute -top-6 left-0 w-full flex justify-between">
            {steps.map((s) => (
              <div class="flex flex-col items-center text-center w-20">
                <div class="flex items-center justify-center w-10 h-10 rounded-full bg-white border-2 border-[#723100]">
                  <s.icon class="w-5 h-5 text-[#FFB703] opacity-0 translate-y-2 transition duration-700" data-step-icon />
                </div>
                <div class="mt-2 text-sm font-semibold text-[#723100]">{s.title}</div>
                <p class="mt-1 text-xs text-[#723100]/80">{s.text}</p>
              </div>
            ))}
          </div>
        </div>
      </div>
    </div>

    <p class="text-sm text-[#723100]/70 max-w-3xl">
      Der Ablauf erfolgt komplett geschlossen – offene Feuer werden nicht benötigt.
    </p>
  </div>

  <!-- Info Cards -->
  <div class="bg-gray-50 py-16">
    <div class="mx-auto max-w-6xl px-6 grid gap-6 md:grid-cols-3">
      {cards.map((c) => (
        <div class="rounded-2xl bg-white shadow-sm ring-1 ring-black/5 p-6">
          <c.icon class="w-8 h-8 text-[#FFB703]" />
          <h3 class="mt-4 font-semibold text-[#723100]">{c.title}</h3>
          <p class="mt-2 text-sm text-[#723100]/80">{c.text}</p>
        </div>
      ))}
    </div>
  </div>

  <script is:client>
    const section = document.getElementById('stepper');
    const icons = section?.querySelectorAll('[data-step-icon]');
    const line = section?.querySelector('#progress');

    if (section && icons && line) {
      const io = new IntersectionObserver((entries) => {
        entries.forEach((e) => {
          if (!e.isIntersecting) return;
          line.style.width = '100%';
          icons.forEach((ico, idx) => {
            setTimeout(() => {
              ico.classList.remove('opacity-0', 'translate-y-2');
            }, 120 * idx);
          });
          io.disconnect();
        });
      }, { threshold: 0.3 });
      io.observe(section);
    }
  </script>
</section>

