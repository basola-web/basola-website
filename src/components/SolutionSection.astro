---
import { Recycle, Settings, FlameKindling, Flame, Droplet, Fuel } from 'lucide-astro';

interface Step {
  title: string;
  text: string;
  icon: any;
}

const steps: Step[] = [
  {
    title: 'Plastikabfall',
    text: 'Gemischte Kunststoffe als Rohstoff. Der Ablauf erfolgt komplett geschlossen.',
    icon: Recycle,
  },
  {
    title: 'Shredder',
    text: 'Zerkleinert zu handlichen Flakes für die Weiterverarbeitung.',
    icon: Settings,
  },
  {
    title: 'Pyrolyse (400–550 °C, O₂-frei)',
    text: 'Thermische Zersetzung ohne offene Flamme – kein Sauerstoff, keine offene Verbrennung.',
    icon: FlameKindling,
  },
  {
    title: 'Syn-Gas: kontrollierte Verbrennung',
    text: 'Das entstehende Gas wird vollständig kontrolliert verbrannt. Liefert Wärme für den Prozess.',
    icon: Flame,
  },
  {
    title: 'Kondensation',
    text: 'Abkühlung trennt flüchtige Fraktionen und wandelt sie in flüssige Bestandteile.',
    icon: Droplet,
  },
  {
    title: 'Fuel (Benzin, Diesel)',
    text: 'Hochwertiger synthetischer Treibstoff (Benzin, Diesel) als Endprodukt.',
    icon: Fuel,
  },
];
---

<section id="loesung" class="font-sans tracking-tight">
  <div class="py-16 mx-auto max-w-6xl px-6">
    <header class="mb-10 text-center md:text-left">
      <h2 class="text-3xl md:text-4xl font-extrabold text-[#723100]">♻️ Unsere Lösung: Sauberer Treibstoff aus Plastikmüll</h2>
      <p class="mt-4 text-lg text-[#723100]/90 max-w-3xl mx-auto md:mx-0">
        Wir verwandeln gemischten Plastikabfall in synthetischen Treibstoff in einem geschlossenen System.
        Der Prozess arbeitet ohne offene Verbrennung und liefert sofort nutzbare Energie.
      </p>
    </header>

    <div id="process-stepper" class="mb-16">
      <!-- mobile vertical -->
      <div class="md:hidden flex flex-col gap-8">
        {steps.map((s) => (
          <div class="flex gap-4">
            <div class="flex-shrink-0 flex items-center justify-center w-12 h-12 rounded-full border-2 border-[#723100] bg-white">
              <s.icon class="w-6 h-6 text-yellow-400" />
            </div>
            <div class="flex-1">
              <h3 class="font-semibold text-[#723100]">{s.title}</h3>
              <div class="mt-2 p-4 bg-gray-50 rounded-xl shadow-md">
                <p class="text-sm text-[#723100]/80 text-justify">{s.text}</p>
              </div>
            </div>
          </div>
        ))}
      </div>

      <!-- desktop horizontal -->
      <div class="hidden md:block">
        <div class="relative">
          <div class="absolute top-6 left-0 w-full h-[4px] bg-[#723100]/30"></div>
          <div data-progress class="absolute top-6 left-0 h-[4px] bg-yellow-400 w-0 transition-all duration-300"></div>

          <div class="flex justify-between">
            {steps.map((s) => (
              <div class="flex flex-col items-center text-center flex-1" data-step>
                <div data-icon class="flex items-center justify-center w-12 h-12 rounded-full border-2 border-[#723100] bg-white transition-all duration-300">
                  <s.icon class="w-6 h-6 text-yellow-400" />
                </div>
                <h3 class="mt-4 text-sm font-semibold text-[#723100]">{s.title}</h3>
                <div class="mt-3 w-full max-w-[150px]" data-card>
                  <div class="p-4 bg-gray-50 rounded-xl shadow-md">
                    <p class="text-xs text-[#723100]/80 text-justify">{s.text}</p>
                  </div>
                </div>
              </div>
            ))}
          </div>
        </div>
      </div>
    </div>
  </div>

  <script is:client>
    const stepper = document.getElementById('process-stepper');
    const steps = stepper?.querySelectorAll('[data-step]');
    const progress = stepper?.querySelector('[data-progress]');

    function activate(index: number) {
      if (!steps || !progress) return;
      steps.forEach((el, i) => {
        const icon = el.querySelector('[data-icon]');
        const card = el.querySelector('[data-card]');
        if (i === index) {
          icon?.classList.add('border-yellow-400', 'bg-yellow-400/10');
          icon?.classList.remove('border-[#723100]');
          card?.classList.add('ring-2', 'ring-yellow-400');
        } else {
          icon?.classList.remove('border-yellow-400', 'bg-yellow-400/10');
          icon?.classList.add('border-[#723100]');
          card?.classList.remove('ring-2', 'ring-yellow-400');
        }
      });
      progress.style.width = `${(index / (steps.length - 1)) * 100}%`;
    }

    function start() {
      let current = 0;
      activate(current);
      const id = setInterval(() => {
        current += 1;
        activate(current);
        if (current === steps.length - 1) clearInterval(id);
      }, 1500);
    }

    const io = new IntersectionObserver(
      (entries) => {
        entries.forEach((e) => {
          if (e.isIntersecting) {
            start();
            io.disconnect();
          }
        });
      },
      { threshold: 0.3 },
    );

    if (stepper) io.observe(stepper);
  </script>
</section>

