---
import { getCollection } from 'astro:content';
import NewsCard from '../../components/NewsCard.astro';

const lang = Astro.url.searchParams.get('lang') ?? 'de';
const all = await getCollection('news', ({ data }) => data.lang === lang && !data.draft);
const items = all.sort((a,b) => +new Date(b.data.date) - +new Date(a.data.date));
---

<html lang={lang}>
  <head>
    <title>Basola – News & Updates</title>
    <meta name="description" content="Neuigkeiten, Preise und Meilensteine von Basola." />
    <link rel="icon" type="image/png" href="/assets/basola_favicon.png" />
  </head>
  <body class="bg-neutral-50">
    <section class="mx-auto max-w-6xl px-6 py-16">
      <header class="mb-8 flex items-end justify-between gap-4">
        <div>
          <h1 class="text-3xl md:text-4xl font-extrabold text-basola-brown">News & Updates</h1>
          <p class="mt-2 text-basola-brown/75">Was es Neues gibt – Auszeichnungen, Meilensteine, Presse.</p>
        </div>
        <div class="flex gap-2">
          <a href="?lang=de" class="rounded-full px-3 py-1 text-sm border border-basola-yellow/60 text-basola-brown bg-white">DE</a>
          <a href="?lang=en" class="rounded-full px-3 py-1 text-sm border border-basola-yellow/0 text-basola-brown/60 hover:border-basola-yellow/60 hover:bg-white">EN</a>
        </div>
      </header>

      <div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
        {items.map(({ id, slug, data }) => (
          <NewsCard
            url={`/news/${slug}`}
            title={data.title}
            date={data.date}
            summary={data.summary}
            tags={data.tags}
            heroImage={data.heroImage}
          />
        ))}
      </div>
    </section>
  </body>
</html>
